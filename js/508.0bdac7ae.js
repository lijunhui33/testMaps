"use strict";(self["webpackChunkvue2_0"]=self["webpackChunkvue2_0"]||[]).push([[508],{508:function(e,t,s){s.r(t),s.d(t,{default:function(){return b}});var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"container"},[t("div",{staticClass:"container-title"},[e._v(e._s("add"==e.type?"新增":"编辑")+"活动")]),t("div",{staticClass:"form-box"},[t("el-form",{ref:"form",attrs:{model:e.form,"label-width":"140px"}},[t("el-form-item",{attrs:{label:"活动名称",required:""}},[t("el-input",{attrs:{placeholder:"请输入活动名称",disabled:e.disabled},model:{value:e.form.title,callback:function(t){e.$set(e.form,"title",t)},expression:"form.title"}})],1),t("el-form-item",{attrs:{label:"活动标签"}},[t("div",[t("div",{staticStyle:{display:"flex"}},[t("el-input",{attrs:{placeholder:"请输入内容后点击右侧按钮添加标签",disabled:e.disabled},model:{value:e.tag,callback:function(t){e.tag=t},expression:"tag"}}),t("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.disabled,expression:"!disabled"}],staticStyle:{"margin-left":"10px"},attrs:{type:"text"},on:{click:e.addTag}},[e._v("点击添加标签")])],1),e.tagList.length?t("div",{staticStyle:{"margin-top":"10px"}},[e._v("*标签点击删除")]):e._e(),t("div",{staticClass:"tag-list"},e._l(e.tagList,(function(s,a){return t("el-button",{key:s,staticClass:"tag",attrs:{disabled:e.disabled,size:"mini"},on:{click:function(t){return e.deleteTag(a)}}},[e._v(" "+e._s(s)+" ")])})),1)])]),t("el-form-item",{attrs:{label:"任务时间",required:""}},[t("el-date-picker",{attrs:{disabled:e.disabled,type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:e.taskTime,callback:function(t){e.taskTime=t},expression:"taskTime"}})],1),t("el-form-item",{attrs:{label:"报名截止时间",required:""}},[t("el-date-picker",{attrs:{disabled:e.disabled,type:"datetime",placeholder:"选择日期","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:e.deadline,callback:function(t){e.deadline=t},expression:"deadline"}})],1),t("el-form-item",{attrs:{label:"任务区域",required:""}},[t("el-select",{attrs:{disabled:e.disabled,placeholder:"请选择"},model:{value:e.form.areaId,callback:function(t){e.$set(e.form,"areaId",t)},expression:"form.areaId"}},e._l(e.addressList,(function(e){return t("el-option",{key:e.value,staticClass:"search-item-inp",attrs:{label:e.label,value:e.value}})})),1),t("span",{staticStyle:{"font-size":"12px","margin-left":"10px",color:"#606266"}},[e._v("*新增任务区域可从系统管理 => 区域管理中新增")])],1),t("el-form-item",{attrs:{label:"任务积分",required:""}},[t("el-input",{attrs:{disabled:e.disabled,placeholder:"完成后获得的任务积分",type:"number"},model:{value:e.form.score,callback:function(t){e.$set(e.form,"score",t)},expression:"form.score"}})],1),t("el-form-item",{attrs:{label:"需要的志愿者总数",required:""}},[t("el-input",{attrs:{disabled:e.disabled,type:"number",placeholder:"请输入需要志愿者数量"},model:{value:e.form.needAmount,callback:function(t){e.$set(e.form,"needAmount",t)},expression:"form.needAmount"}})],1),t("el-form-item",{attrs:{label:"活动内容"}},[t("el-input",{attrs:{disabled:e.disabled,type:"textarea",autosize:{minRows:6,maxRows:10}},model:{value:e.form.content,callback:function(t){e.$set(e.form,"content",t)},expression:"form.content"}})],1),t("el-form-item",[t("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.disabled,expression:"!disabled"}],attrs:{type:"primary",loading:e.loading},on:{click:e.save}},[e._v("保存")]),t("el-button",{on:{click:e.back}},[e._v("返回")])],1)],1)],1),e.addressVisible?t("select-address",{ref:"selectAddressRef",attrs:{visible:e.addressVisible},on:{ok:e.handleSelectAddress,cancel:function(t){e.addressVisible=!1}}}):e._e()],1)},i=[],r=(s(7658),s(1392)),d=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{title:"选择位置",width:"800px",visible:e.visible,confirmLoading:e.loading},on:{close:()=>{e.$emit("cancel")}}},[t("div",{staticStyle:{height:"500px",width:"100%","text-align":"center","line-height":"500px","font-size":"20px"},attrs:{id:"container"}},[e._v("加载中... ")]),e.disabled?e._e():[t("div",{staticStyle:{display:"flex",margin:"20px 0"}},[t("el-input",{attrs:{placeholder:"输入地名"},model:{value:e.selectAddressName,callback:function(t){e.selectAddressName=t},expression:"selectAddressName"}}),t("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary"},on:{click:function(t){return e.onSearch(e.selectAddressName)}}},[e._v("搜索")])],1)],e.disabled?e._e():[t("el-select",{staticStyle:{width:"50%"},attrs:{placeholder:"请选择地址"},model:{value:e.addressValue,callback:function(t){e.addressValue=t},expression:"addressValue"}},e._l(e.resMapList,(function(s,a){return t("el-option",{key:s.id,staticStyle:{"background-color":"#fff"},attrs:{label:s.name,value:s.id},on:{click:function(t){return e.handleChange(s,a)}}},[t("div",{staticStyle:{color:"#333","font-weight":"bold"}},[e._v(" "+e._s(s.name)+" ")]),t("div",{staticStyle:{color:"#666","font-size":"13px"}},[e._v(" "+e._s(s.address)+" ")])])})),1),t("div",{staticStyle:{"margin-top":"10px",color:"#333"}},[e._v("已选："+e._s(e.address)+"（"+e._s(e.addressName)+"）")]),e.remark?t("div",{staticStyle:{"margin-top":"10px",color:"#333"}},[e._v(e._s(e.remark))]):e._e()],t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:()=>{e.$emit("cancel")}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:()=>{e.$emit("ok",{addressName:e.addressName,address:e.address,location:e.location})}}},[e._v("确 定")])],1)],2)},l=[];const n=window.qq;var o={props:{visible:{type:Boolean,required:!0},disabled:{type:Boolean,default:!1},remark:{type:String,default:""},lat:{type:Number,default:21.820949},lng:{type:Number,default:112.052254}},data(){return{loading:!1,map:null,resMapList:[],addressValue:void 0,marker:null,location:null,address:"广东省阳江市阳东区",addressName:"雅韶镇",openStatus:!1,selectAddressName:""}},mounted(){const e=new n.maps.LatLng(this.lat,this.lng),t={zoom:15,center:e,mapTypeId:n.maps.MapTypeId.ROADMAP};setTimeout((()=>{const s=this,a=new n.maps.Map(document.getElementById("container"),t);this.map=a;let i=null;this.lat&&(i=new n.maps.Marker({position:e,map:a})),this.map=a,this.marker=i,this.location={lat:this.lat,lng:this.lng},n.maps.event.addListener(a,"click",(function(e){if(this.disabled)return;const t=new n.maps.Geocoder({complete:e=>{if(s.resMapList=e.detail.nearPois||[],s.address=e.detail.address,s.location=e.detail.location,e.detail.nearPois&&e.detail.nearPois.length>0){s.addressValue=e.detail.nearPois[0].id;const t=e.detail.nearPois[0];s.address=t.address,s.addressName=t.name,this.location={lat:t.lat,lng:t.lng}}}});i&&i.setMap(null),s.marker&&s.marker.setMap(null),i=new n.maps.Marker({position:e.latLng,map:a}),a.setZoom(20),a.setCenter(e.latLng),new n.maps.LatLng;const r=new n.maps.LatLng(e.latLng.getLat(),e.latLng.getLng());t.getAddress(r)}))}),500)},methods:{onSearch(e){const t=this;this.addressValue=void 0;const s=new n.maps.SearchService({complete:function(a){if("CITY_LIST"===a.type)return s.setLocation(a.detail.cities[0].cityName),void(e?s.search(e):s.search(t.state.mapKeywords));const i=a.detail.pois;t.resMapList=i;const r=new n.maps.LatLngBounds;for(let e=0,t=i.length;e<t;e++){const t=i[e];r.extend(t.latLng)}t.map.fitBounds(r)}});s.search(e)},handleChange(e,t){this.addressValue=t,this.addressName=e.name,this.mapKeywords=e.name,this.map.setCenter(e.latLng),this.map.setZoom(20),this.marker&&this.marker.setMap(null),this.marker=new n.maps.Marker({position:e.latLng,map:this.map}),this.address=e.address,this.location=e.latLng}}},c=o,m=s(1001),h=(0,m.Z)(c,d,l,!1,null,null,null),u=h.exports,p=s(9488),f={components:{selectAddress:u},data(){return{type:"",form:{title:"",content:"",areaId:"",score:null,needAmount:null},tag:"",tagList:[],taskTime:[],deadline:"",loading:!1,addressVisible:!1,address:{province:"广东省",city:"阳江市",district:"阳东区",districtCode:"",address:"雅韶镇",geographyInfo:{lat:21.820949,lng:112.052254}},addressStr:"广东省阳江市阳东区雅韶镇",disabled:!1}},created(){this.addressList=this.$store.state.addressList;const{type:e,id:t}=this.$route.query;this.type=e,"edit"!=e&&"preview"!=e||!t||(this.id=t,this.getDetail()),"preview"==e&&(this.disabled=!0)},methods:{getDetail(){(0,r.Ht)({activityId:this.id}).then((e=>{if(0==e.data.code){const{activityRow:t}=e.data.data,{title:s,tagList:a,beginTime:i,endTime:r,deadline:d,areaId:l,score:n,needAmount:o,content:c}=t;console.log(t),this.form.title=s,this.tagList=a.length?a.split(","):[],i&&r&&(this.taskTime=[(0,p.Z)(i),(0,p.Z)(r)]),d&&(this.deadline=(0,p.Z)(d)),this.form.areaId=`${l}`,this.form.score=n,this.form.needAmount=o,this.form.content=c}else this.$message.warning("请求详情失败")}))},back(){this.$router.go(-1)},addTag(){this.tag&&(-1===this.tagList.indexOf(this.tag)?(this.tagList.push(this.tag),this.tag=""):this.$message.error("重复标签"))},save(){"add"===this.type?this.activePublish():this.activeUpdate()},activeUpdate(){if(!this.form.title)return void this.$message.error("请填写标题");if(!this.taskTime.length)return void this.$message.error("请选择任务时间");if(!this.deadline)return void this.$message.error("请选择任务截止时间");if(!this.form.areaId)return void this.$message.error("请选择任务区域");if(!this.form.score)return void this.$message.error("请填写任务积分");if(!this.form.needAmount)return void this.$message.error("请填写需要志愿者人数");const e=this.taskTime[0]?new Date(this.taskTime[0]).getTime():"",t=this.taskTime[1]?new Date(this.taskTime[1]).getTime():"",s=this.deadline?new Date(this.deadline).getTime():"",a={title:this.form.title,tagList:this.tagList.join(","),content:this.form.content,beginTime:e,endTime:t,deadline:s,areaId:this.form.areaId,score:this.form.score,needAmount:this.form.needAmount,id:this.id};this.loading=!0,(0,r.aX)(a).then((e=>{0==e.data.code?(this.$message.success("更新成功"),setTimeout((()=>{this.$router.go(-1)}),2e3)):this.$message.error(`${e.data.message},${e.data.detail}`),this.loading=!1})).catch((()=>{this.loading=!1}))},activePublish(){if(!this.form.title)return void this.$message.error("请填写标题");if(!this.taskTime.length)return void this.$message.error("请选择任务时间");if(!this.deadline)return void this.$message.error("请选择任务截止时间");if(!this.form.areaId)return void this.$message.error("请选择任务区域");if(!this.form.score)return void this.$message.error("请填写任务积分");if(!this.form.needAmount)return void this.$message.error("请填写需要志愿者人数");const e=this.taskTime[0]?new Date(this.taskTime[0]).getTime():"",t=this.taskTime[1]?new Date(this.taskTime[1]).getTime():"",s=this.deadline?new Date(this.deadline).getTime():"",a={title:this.form.title,tagList:this.tagList.join(","),content:this.form.content,beginTime:e,endTime:t,deadline:s,areaId:this.form.areaId,score:this.form.score,needAmount:this.form.needAmount};this.loading=!0,(0,r.JU)(a).then((e=>{0==e.data.code?(this.$message.success("发布成功"),setTimeout((()=>{this.$router.go(-1)}),2e3)):this.$message.error(`${e.data.message},${e.data.detail}`),this.loading=!1})).catch((()=>{this.loading=!1}))},deleteTag(e){this.tagList.splice(e,1)},handleSelectAddress(e){const t=this.strAddress(e.address);this.address.province=t[0],this.address.city=t[1],this.address.district=t[2],this.address.geographyInfo=e.location,this.address.address=e.addressName,this.addressStr=this.address.province+this.address.city+this.address.district+this.address.address,this.addressVisible=!1},strAddress(e){let t=e;const s=/.+?(省|市|自治区|自治州|行政区|盟|旗|县|区)/g,a=t.match(s);return a}}},g=f,v=(0,m.Z)(g,a,i,!1,null,"095b43ce",null),b=v.exports},1392:function(e,t,s){s.d(t,{Ht:function(){return d},JU:function(){return i},aX:function(){return l},bC:function(){return n},yN:function(){return r}});var a=s(8108);const i=e=>(0,a.xW)("/activity/publish",e),r=e=>(0,a.FP)("/activity/list",e),d=e=>(0,a.FP)("/activity/detail",e),l=e=>(0,a.xW)("/activity/update",e),n=e=>(0,a.xW)("/activity/delete",e)},9488:function(e,t){const s=e=>{if(!e)return"";const t=e=>e>=10?e:"0"+e,s=new Date(Number(e)),a=s.getFullYear(),i=s.getMonth()+1,r=s.getDate(),d=s.getHours(),l=s.getMinutes(),n=s.getSeconds();return a+"-"+t(i)+"-"+t(r)+" "+t(d)+":"+t(l)+":"+t(n)};t["Z"]=s}}]);
//# sourceMappingURL=508.0bdac7ae.js.map