"use strict";(self["webpackChunkvue2_0"]=self["webpackChunkvue2_0"]||[]).push([[822],{1822:function(t,e,i){i.r(e),i.d(e,{default:function(){return b}});var o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"container"},[e("div",{staticClass:"container-title"},[t._v("投票列表")]),e("div",{staticClass:"user-btn"},[e("el-button",{staticClass:"user-btn-inp",attrs:{type:"primary"},on:{click:t.add}},[t._v("新增")])],1),e("div",{staticClass:"table-list"},[e("el-table",{ref:"singleTable",staticStyle:{width:"100%"},attrs:{data:t.tableData}},[e("el-table-column",{attrs:{property:"id",label:"id",width:"50"}}),e("el-table-column",{attrs:{property:"title",label:"标题"}}),e("el-table-column",{attrs:{property:"createTime",label:"创建时间"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.timerHandler(e.row.createTime))+" ")]}}])}),e("el-table-column",{attrs:{property:"timerArr",label:"投票时间",width:"500"}}),e("el-table-column",{attrs:{fixed:"right",label:"操作",width:"240"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(e){return e.preventDefault(),t.newPosition(i.row)}}},[t._v(" 创建选项 ")]),e("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(e){return e.preventDefault(),t.previewPosition(i.row)}}},[t._v(" 查看选项 ")]),e("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(e){return e.preventDefault(),t.previewVote(i.row)}}},[t._v(" 预览 ")]),e("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(e){return e.preventDefault(),t.editVote(i.row)}}},[t._v(" 编辑 ")]),e("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(e){return e.preventDefault(),t.deletes(i.row)}}},[t._v(" 移除 ")])]}}])})],1),e("div",{staticClass:"pagination"},[e("el-pagination",{attrs:{"current-page":t.form.pageNumber,layout:"prev, pager, next,jumper",total:t.total,"page-size":t.form.pageSize},on:{"current-change":t.currentChange}})],1)],1),e("el-dialog",{attrs:{title:"新增选项",visible:t.dialogVisible},on:{"update:visible":function(e){t.dialogVisible=e}}},[t._l(t.dialog1Option,(function(i,o){return e("div",{key:`dialog1${o}`},[e("div",{staticStyle:{padding:"20px 10px","font-size":"16px","font-weight":"bold"}},[t._v("选项"+t._s(o+1)+" "),e("el-button",{directives:[{name:"show",rawName:"v-show",value:0!=o,expression:"index != 0"}],staticStyle:{"margin-left":"20px"},attrs:{type:"text"},on:{click:function(e){return t.deleteDialog1(o)}}},[t._v("删除")])],1),e("el-form",{ref:"form",refInFor:!0,attrs:{model:i,"label-width":"80px"}},[e("el-form-item",{attrs:{label:"选项标题"}},[e("el-input",{staticStyle:{width:"375px"},model:{value:i.title,callback:function(e){t.$set(i,"title",e)},expression:"item.title"}})],1),e("el-form-item",{attrs:{label:"选项描述"}},[e("el-input",{staticStyle:{width:"375px"},attrs:{type:"textarea",autosize:{minRows:2,maxRows:4}},model:{value:i.description,callback:function(e){t.$set(i,"description",e)},expression:"item.description"}})],1),e("el-form-item",{attrs:{label:"上传文件"}},[e("voteUpload",{attrs:{fileList:i.dialog1FileList,index:o,type:"upload"},on:{success:t.uploadSuccess,removes:t.uploadRemove}})],1)],1)],1)})),e("div",{},[e("el-button",{on:{click:t.addDialogForm}},[t._v("新增选项")])],1),e("div",{attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary"},on:{click:t.addOption}},[t._v("确 定")])],1)],2),e("el-dialog",{attrs:{title:"编辑选项",visible:t.dialogVisible2},on:{"update:visible":function(e){t.dialogVisible2=e}}},t._l(t.dialog2Option,(function(i,o){return e("div",{key:`dialog1${o}`},[e("div",{staticStyle:{padding:"20px 10px","font-size":"16px","font-weight":"bold"}},[t._v("选项"+t._s(o+1)+" "),e("el-button",{staticStyle:{"margin-left":"20px"},attrs:{type:"text"},on:{click:function(e){return t.editDialog2(o)}}},[t._v("保存")]),e("el-button",{staticStyle:{"margin-left":"20px"},attrs:{type:"text"},on:{click:function(e){return t.deleteDialog2(o)}}},[t._v("删除")])],1),e("el-form",{ref:"form",refInFor:!0,attrs:{model:i,"label-width":"80px"}},[e("el-form-item",{attrs:{label:"选项标题"}},[e("el-input",{staticStyle:{width:"375px"},model:{value:i.title,callback:function(e){t.$set(i,"title",e)},expression:"item.title"}})],1),e("el-form-item",{attrs:{label:"选项描述"}},[e("el-input",{staticStyle:{width:"375px"},attrs:{type:"textarea",autosize:{minRows:2,maxRows:4}},model:{value:i.description,callback:function(e){t.$set(i,"description",e)},expression:"item.description"}})],1),e("el-form-item",{attrs:{label:"上传文件"}},[e("voteUpload",{attrs:{fileList:i.fileList,index:o,type:"detail"},on:{success:t.uploadSuccess,removes:t.uploadRemove}})],1)],1)],1)})),0)],1)},s=[],a=(i(7658),i(8208)),l=i(9488),n=function(){var t=this,e=t._self._c;return e("div",[e("el-upload",{ref:"upload",attrs:{action:t.url,multiple:"","file-list":t.fileList,accept:".png,.jpeg,.jpg,.mp4,.avi",headers:t.headers,"on-success":t.success,"on-remove":t.removes,"on-preview":t.preview}},[e("el-button",{attrs:{size:"small",type:"primary"}},[t._v("点击上传")])],1),e("el-dialog",{attrs:{"append-to-body":"",title:"预览",visible:t.imgDialog,width:"width"},on:{"update:visible":function(e){t.imgDialog=e},close:t.dialogClose}},[e("div",{staticClass:"img-box"},["img"==t.dialogType?e("img",{attrs:{src:t.imgSrc,alt:"",srcset:""}}):t._e(),"video"==t.dialogType?e("video",{staticStyle:{width:"400px"},attrs:{controls:"controls",src:t.videoSrc,"z-index":"1000"}}):t._e()])])],1)},r=[],d=i(6304),p={data(){return{headers:{"ysxf-auth-data":this.$store.state.userData,"ysxf-upload-data":JSON.stringify({category:"vote"})},url:`${d.Z.URL}/file/upload/cos`,imgSrc:"",imgDialog:!1,videoDialog:!0,videoSrc:"",dialogType:""}},props:{fileList:Array,index:Number,type:String},methods:{isImage(t){var e=t.lastIndexOf("."),i=t.substr(e+1);return this.isImageType(i)},isImageType(t){return-1!==["png","jpg","jpeg","bmp","gif","webp","psd","svg","tiff"].indexOf(t.toLowerCase())},success(t){this.$emit("success",{index:this.index,data:t.data,type:this.type})},removes(t){t.response&&t.response.data&&t.response.data.id&&this.$emit("removes",{index:this.index,id:t.response.data.id,type:this.type})},preview(t){console.log(t),t.response?this.isImage(t.response.data.url)?(this.imgSrc=`http://${t.response.data.url}`,this.imgDialog=!0,this.dialogType="img"):(this.dialogType="video",this.imgDialog=!0,this.videoSrc=`http://${t.response.data.url}`):t.url&&(this.isImage(t.url)?(this.imgSrc=`http://${t.url}`,this.imgDialog=!0,this.dialogType="img"):(this.imgDialog=!0,this.dialogType="video",this.videoSrc=`http://${t.url}`))},dialogClose(){const t=document.querySelectorAll("video");t&&t.forEach((t=>{t.pause()}))}},watch:{fileList:{handler:function(t){console.log(t)},deep:!0}}},c=p,u=i(1001),g=(0,u.Z)(c,n,r,!1,null,"61060fde",null),h=g.exports,f={components:{voteUpload:h},data(){return{tableData:[],form:{pageNumber:1,pageSize:10,isPaging:!0},total:0,input:"",timerHandler:l.Z,dialogVisible:!1,headers:{"ysxf-auth-data":this.$store.state.userData,"ysxf-upload-data":JSON.stringify({category:"vote"})},dialog1Option:[{title:"",description:"",fileIdList:[],dialog1FileList:[]}],dialog2Option:[],dialogVisible2:!1}},created(){this.getList()},methods:{currentChange(t){this.form.pageNumber=t,this.getList()},getList(){(0,a.Us)(this.form).then((t=>{0==t.data.code?(this.total=t.data.data.amount,this.tableData=t.data.data.rows.map((t=>({...t,timerArr:(0,l.Z)(t.beginTime)+" ~ "+(0,l.Z)(t.endTime)})))):(this.total=0,this.tableData=[],this.form.pageNumber=1)}))},handleClick(t){console.log(t)},add(){this.$router.push({path:"/vote/voteAddOrEdit",query:{type:"add"}})},handleCurrentChange(t){console.log(t)},deletes(t){this.$confirm("此操作将永久删除该投票, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.deleteVote(t)})).catch((()=>{}))},deleteVote(t){(0,a.iz)({id:t.id}).then((t=>{0==t.data.code?(this.$message.success("删除成功"),this.getList()):this.$message.error(`${t.data.message},${t.data.detail}`)}))},editVote(t){this.$router.push({path:"/vote/voteAddOrEdit",query:{type:"edit",id:t.id}})},previewVote(t){this.$router.push({path:"/vote/voteAddOrEdit",query:{type:"preview",id:t.id}})},newPosition(t){this.voteId=t.id,this.dialog1Option=[{title:"",description:"",fileIdList:[],dialog1FileList:[]}],this.dialogVisible=!0},dialog1Success(t){console.log(t)},dialog1Onchange(t,e){this.dialog1FileList=e},dialogBtn(t){this.dialogIndex=t},addDialogForm(){this.dialog1Option.push({title:"",description:"",fileIdList:[],dialog1FileList:[]})},deleteDialog1(t){this.dialog1Option.splice(t,1)},uploadSuccess(t){this.dialog1Option[t.index]&&"upload"==t.type&&this.dialog1Option[t.index].fileIdList.push(t.data.id),this.dialog2Option[t.index]&&"detail"==t.type&&this.dialog2Option[t.index].fileIdList.push(t.data.id)},uploadRemove(t){if(this.dialog1Option[t.index]&&"upload"==t.type){const e=this.dialog1Option[t.index].fileIdList.indexOf(t.id);-1!=e&&this.dialog1Option[t.index].fileIdList.splice(e,1)}if(this.dialog2Option[t.index]&&"detail"==t.type){const e=this.dialog2Option[t.index].fileIdList.indexOf(t.id);-1!=e&&this.dialog2Option[t.index].fileIdList.splice(e,1)}},addOption(){const t=[];if(this.dialog1Option.forEach(((e,i)=>{e.description&&e.title||t.push(i+1)})),t.length)return void this.$message.error(`请确保${t.join(",")}行的标题和描述已填`);const e=[];this.dialog1Option.forEach((t=>{e.push({voteId:this.voteId,title:t.title,description:t.description,fileIdList:t.fileIdList.join(",")})})),(0,a.eE)({optionDataList:e,voteId:this.voteId}).then((t=>{0==t.data.code?(this.dialogVisible=!1,this.dialog1Option=[{title:"",description:"",fileIdList:[],dialog1FileList:[]}],this.$message.success("新增成功")):this.$message.error(`${t.data.message},${t.data.detail}`)}))},previewPosition(t){(0,a.q3)({voteId:t.id}).then((e=>{if(0==e.data.code){if(this.dialog2Option=[],!e.data.data.rows.length)return this.$message.error("没有选项"),void(this.dialogVisible2=!1);e.data.data.rows.forEach((e=>{console.log(e);const i=e.optionRow.fileIdList.split(","),{fileRowList:o}=e,s=[];i.forEach((t=>{o.forEach((e=>{e.id==t&&s.push({url:`${e.url}`,id:e.id,name:e.originName})}))})),this.dialog2Option.push({title:e.optionRow.title,description:e.optionRow.description,fileIdList:!!e.optionRow.fileIdList>0?e.optionRow.fileIdList.split(","):[],fileList:s,voteOptionId:e.optionRow.id,voteId:t.id})})),this.dialogVisible2=!0}}))},deleteDialog2(t){const e=this.dialog2Option[t].voteOptionId,i=this.dialog2Option[t].voteId;(0,a.lJ)({id:e}).then((t=>{0==t.data.code?(this.$message.success("删除成功"),this.previewPosition({id:i})):this.$message.error("删除失败")}))},editDialog2(t){console.log(t,a.f$);const e=this.dialog2Option[t];console.log(e),(0,a.f$)({id:e.voteOptionId,title:e.title,description:e.description,fileIdList:e.fileIdList.join(",")}).then((t=>{0==t.data.code?this.$message.success("更新成功"):this.$message.error("更新失败")}))}}},m=f,v=(0,u.Z)(m,o,s,!1,null,"3ef51766",null),b=v.exports},8208:function(t,e,i){i.d(e,{UX:function(){return n},Us:function(){return a},eE:function(){return d},f$:function(){return u},iz:function(){return r},lJ:function(){return c},m7:function(){return s},nF:function(){return l},q3:function(){return p}});var o=i(8108);const s=t=>(0,o.xW)("/vote/create",t),a=t=>(0,o.FP)("/vote/list",t),l=t=>(0,o.FP)("/vote/detail",t),n=t=>(0,o.xW)("/vote/update",t),r=t=>(0,o.xW)("/vote/delete",t),d=t=>(0,o.xW)("/vote/option/create/batch",t),p=t=>(0,o.FP)("/vote/option/list",t),c=t=>(0,o.xW)("/vote/option/delete",t),u=t=>(0,o.xW)("/vote/option/update",t)},9488:function(t,e){const i=t=>{if(!t)return"";const e=t=>t>=10?t:"0"+t,i=new Date(Number(t)),o=i.getFullYear(),s=i.getMonth()+1,a=i.getDate(),l=i.getHours(),n=i.getMinutes(),r=i.getSeconds();return o+"-"+e(s)+"-"+e(a)+" "+e(l)+":"+e(n)+":"+e(r)};e["Z"]=i}}]);
//# sourceMappingURL=822.8fa8f32d.js.map